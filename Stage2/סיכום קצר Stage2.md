<div dir="rtl">

# סיכום פרויקט ניהול סטודנטים - Stage2

## מה הפרויקט עושה בשלב זה?

ב-Stage2, המערכת מתפתחת ומרחיבה את יכולות ניהול הסטודנטים. הפעולות הבסיסיות על סטודנטים נשארות, אך נוספת להן יכולת חשובה:

* **ניהול פרטים נוספים של סטודנט (StudentDetails):**
    * לכל סטודנט יכול להיות סט פרטים נוסף אחד (קשר של אחד-לאחד).
    * פרטים אלו כוללים: כתובת, מספר טלפון, איש קשר לשעת חירום ומספר הטלפון שלו.
    * ניתן ליצור, לקרוא, לעדכן ולמחוק את פרטי הסטודנט, והם מקושרים לסטודנט ספציפי.
* **פעולות CRUD על סטודנטים נמשכות:** כמו ב-Stage1, ניתן להוסיף, לקרוא, לעדכן ולמחוק סטודנטים. בעת יצירה או עדכון סטודנט, ניתן לכלול גם את פרטיו הנוספים.

**מה עדיין אין בשלב זה:**
* אין ניהול של מורים.
* אין קשרים בין סטודנטים למורים.

## איך הוא בנוי? (הארכיטקטורה)

הארכיטקטורה נשארת דומה ל-Stage1, אך עם הרחבות לתמיכה בישות החדשה:

1.  **קומת הבקרים (Controllers):**
    * `StudentController`: ממשיך לנהל סטודנטים.
    * **`StudentDetailsController` (חדש):** בקר ייעודי לניהול פרטי סטודנטים. הוא פועל תחת נתיב ספציפי המקושר לסטודנט (למשל, `/students/{studentId}/details`).

2.  **קומת השירותים (Services):**
    * `StudentServiceImpl`: לוגיקה עסקית לסטודנטים, כולל טיפול בקשר לפרטים הנוספים.
    * **`StudentDetailsServiceImpl` (חדש):** לוגיקה עסקית לניהול פרטי הסטודנטים.

3.  **קומת מאגרי המידע (Repositories):**
    * `StudentRepository`: ממשיך לנהל סטודנטים.
    * **`StudentDetailsRepository` (חדש):** מאגר מידע לפרטי סטודנטים.

4.  **קומת הישויות (Entities):**
    * `Student`: הישות הורחבה כדי לכלול קשר `OneToOne` לישות `StudentDetails`. הסטודנט הוא "הבעלים" של הקשר.
    * **`StudentDetails` (חדש):** ישות חדשה המכילה פרטים נוספים על הסטודנט.

5.  **קומת אובייקטי העברת נתונים (DTOs):**
    * `StudentDto`: הורחב כדי לכלול אובייקט `StudentDetailsDto` מקונן.
    * **`StudentDetailsDto` (חדש):** DTO להעברת פרטי סטודנט. כולל שדה `studentId` לקישור קל לסטודנט.

6.  **קומת המתרגמים (Mappers):**
    * `StudentMapper`: הורחב כדי לטפל בהמרה של `StudentDetails` ו-`StudentDetailsDto`.

7.  **טיפול בשגיאות (Exceptions):**
    * המנגנון הקיים מ-Stage1 ממשיך לפעול. נוספה חריגה `InvalidRequestException` לטיפול בבקשות לא תקינות ספציפיות לפרטי סטודנט (למשל, אי-התאמה ב-`studentId`).

8.  **תגובות סטנדרטיות (Response):**
    * `StandardResponse`: ממשיך לשמש למבנה תגובה אחיד.

9.  **אתחול נתונים (DataInitializer):**
    * עודכן כדי ליצור גם נתוני `StudentDetails` עבור חלק מהסטודנטים לדוגמה.

## טכנולוגיות עיקריות:

הטכנולוגיות נשארות זהות ל-Stage1.

## מה חדש ב-Stage2 (בהשוואה ל-Stage1):

* **ישות חדשה (`StudentDetails`):** מידול של פרטים נוספים לסטודנט.
* **קשר One-to-One:** מימוש קשר אחד-לאחד דו-כיווני בין `Student` ל-`StudentDetails`.
    * הסטודנט הוא הבעלים של הקשר (`@JoinColumn` בישות `Student`).
    * בצד `StudentDetails` יש `mappedBy`.
    * נעשה שימוש ב-`cascade = CascadeType.ALL` ו-`orphanRemoval = true` בישות `Student` לניהול מחזור החיים של `StudentDetails` (פרטים נמחקים אם הקשר לסטודנט מוסר).
* **DTO ו-Mapper חדשים/מורחבים:** `StudentDetailsDto` ועדכון `StudentMapper` ו-`StudentDto`.
* **Controller ושירות חדשים:** `StudentDetailsController` ו-`StudentDetailsServiceImpl` לניהול ייעודי של פרטי הסטודנט.
* **ולידציות נוספות:** ולידציות על שדות ב-`StudentDetailsDto` (כמו תבנית מספר טלפון ישראלי).
* **טיפול משופר בשיוך `studentId`:** ב-`StudentDetailsController` ובשירות המתאים, נוספה לוגיקה לוודא התאמה בין `studentId` שנשלח בנתיב ה-URL לזה שעשוי להישלח בגוף הבקשה, למניעת שיוכים שגויים.
* **שימוש ב-`@ResponseStatus(HttpStatus.NO_CONTENT)`:** למתודות מחיקה שמחזירות `void`, כדי להבטיח קוד סטטוס HTTP 204.

## לסיכום:

Stage2 מרחיב את המערכת הבסיסית על ידי הוספת ישות מקושרת (`StudentDetails`) והקשרים הנדרשים בינה לבין הישות הקיימת (`Student`). שלב זה מדגים כיצד לנהל יחסי אחד-לאחד ב-JPA, כולל ניהול מחזור חיים של ישויות תלויות, וכיצד לבנות API ייעודי לניהול הישות החדשה כחלק מהישות הראשית. הדגש הוא על שמירת עקביות הנתונים והקשרים ביניהם.
</div>