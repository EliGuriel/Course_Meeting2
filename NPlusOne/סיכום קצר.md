<div dir="rtl">

# סיכום פרויקט "NPlusOne"

## מה הפרויקט עושה?

פרויקט `NPlusOne` נועד להדגים ולחקור את **בעיית N+1 שאילתות** הנפוצה בעבודה עם JPA ו-Hibernate. הבעיה מתרחשת כאשר טעינת נתונים מקושרים (למשל, סטודנטים של מורה, או פרטים נוספים של סטודנט) מתבצעת באופן לא יעיל, כך שנוצרת שאילתה ראשית אחת (למשל, לשליפת כל המורים) ולאחר מכן שאילתות נוספות (N שאילתות) עבור כל פריט ברשימה הראשונית כדי לטעון את הנתונים המקושרים שלו.

הפרויקט מציג:

* **תרחיש הגורם לבעיית N+1:** שליפת רשימת מורים (`Teacher`) כאשר כל מורה מכיל רשימת סטודנטים (`Student`), וכל סטודנט מכיל פרטים נוספים (`StudentDetails`). הגישה לרשימות המקושרות הללו במהלך המרת הישויות ל-DTOs (אם הן מוגדרות כ-`WorkspaceType.LAZY`) תגרום לשאילתות נוספות.
* **פתרונות לבעיית N+1:**
    * שימוש ב-**JOIN FETCH** בשאילתות JPQL כדי לטעון את כל הנתונים הנדרשים בשאילתה אחת.
    * שימוש ב-**EntityGraph** של JPA כדי להגדיר באופן דקלרטיבי אילו קשרים לטעון במיידי.

## איך הוא בנוי? (הארכיטקטורה)

הפרויקט פשוט יחסית וממוקד בהדגמת הבעיה והפתרונות:

1.  **קומת הבקרים (Controllers):**
    * `TeacherController`: חושף נקודות קצה (endpoints) שונות לשליפת רשימת מורים, כאשר כל נקודת קצה משתמשת בשיטת טעינה אחרת בשכבת השירות (אחת שמדגימה את הבעיה, ואחרות שמדגימות פתרונות).

2.  **קומת השירותים (Services):**
    * `TeacherService`: מכיל את הלוגיקה לשליפת המורים והמרתם ל-DTOs. ישנן מספר מתודות:
        * `getAllTeachersWithN1Problem()`: מדגימה את הבעיה, טוענת מורים ואז ניגשת לקשרים עצלים באופן שיוצר שאילתות נוספות.
        * `getAllTeachersWithoutN1Problem()`: משתמשת בשאילתת `JOIN FETCH` מותאמת אישית מה-Repository לטעינה יעילה.
        * `getAllTeachersWithEntityGraph()`: מדגימה שימוש ב-`@EntityGraph`.

3.  **קומת מאגרי המידע (Repositories):**
    * `TeacherRepository`: כולל מספר מתודות `findAll` עם אסטרטגיות טעינה שונות:
        * מתודה רגילה (`findAll()` ברירת מחדל של JpaRepository).
        * מתודה עם `@Query` המשתמשת ב-`LEFT JOIN FETCH` (`findAllWithStudentsAndDetails()`).
        * מתודה עם `@EntityGraph` (`findAllWithGraph()`).
    * `StudentRepository`: מאגר מידע סטנדרטי לסטודנטים.

4.  **קומת הישויות (Entities):**
    * `Teacher`: ישות מורה עם קשר `OneToMany` ל-`Student` (מוגדר כ-`WorkspaceType.LAZY` כברירת מחדל עבור קשר זה).
    * `Student`: ישות סטודנט עם קשר `ManyToOne` ל-`Teacher` וקשר `OneToOne` ל-`StudentDetails` (גם כן מוגדר כ-`WorkspaceType.LAZY`).
    * `StudentDetails`: ישות לפרטים נוספים של סטודנט.

5.  **קומת אובייקטי העברת נתונים (DTOs):**
    * `TeacherDto`: כולל רשימה של `StudentDto`.
    * `StudentDto`: כולל שדות כמו שם ומספר טלפון (שנלקח מ-`StudentDetails`).

6.  **אתחול נתונים (DataInitializer):**
    * יוצר נתוני דוגמה של מורים, סטודנטים ופרטי סטודנטים, כולל קישורים ביניהם, כדי שיהיה מספיק מידע להדגים את בעיית ה-N+1.

## מטרות הפרויקט:

* **הדגמה ויזואלית (דרך לוגים של SQL) של בעיית N+1 שאילתות.**
* **הצגת והשוואת פתרונות שונים לבעיה:** JOIN FETCH ו-EntityGraph.
* **לימוד החשיבות של טעינה יעילה של נתונים** באפליקציות המשתמשות ב-ORM.
* **הבנה של מנגנון `WorkspaceType.LAZY` וכיצד גישה לקשרים אלו יכולה להפעיל שאילתות נוספות.**

## טכנולוגיות עיקריות:

* Java, Spring Boot, JPA (Hibernate), MySQL, Lombok.

## מה לומדים מהפרויקט?

* **זיהוי בעיית N+1:** כיצד לזהות את התופעה באמצעות ניתוח שאילתות ה-SQL הנוצרות (למשל, על ידי הפעלת `spring.jpa.show-sql=true`).
* **פתרונות מעשיים:** יישום של טכניקות כמו `JOIN FETCH` ו-`@EntityGraph` למיטוב שאילתות.
* **השפעת מבנה ה-DTO והמרתו על טעינת נתונים:** כיצד הגישה לשדות ב-Entity במהלך יצירת ה-DTO יכולה "לאלץ" טעינה של קשרים עצלים.

## לסיכום:

פרויקט `NPlusOne` הוא דוגמה ממוקדת וחשובה המדגימה בעיית ביצועים קריטית בעבודה עם JPA. הוא מספק הבנה טובה של הבעיה ומציג כלים יעילים לפתרונה, החיוניים לכל מפתח העובד עם ORM.
</div>