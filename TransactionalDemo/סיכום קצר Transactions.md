<div dir="rtl">

# סיכום פרויקט "TransactionalDemo"

## מה הפרויקט עושה?

פרויקט `TransactionalDemo` נועד להדגים את **השימוש וההתנהגות של טרנזקציות** ב-Spring Boot, תוך התמקדות באנוטציה `@Transactional`. המערכת מדמה פעולות בסיסיות בניהול בית ספר, כמו יצירה ועדכון של מורים (`Teacher`) ותלמידים (`Student`), ומראה כיצד טרנזקציות מבטיחות את שלמות הנתונים (Data Integrity) גם במקרה של שגיאות.

הפרויקט מדגים:

* **פעולות אטומיות:** כיצד פעולות מרובות על בסיס הנתונים (למשל, יצירת מורה ושיוך תלמיד אליו) מתבצעות כיחידה אחת – או שכל הפעולות מצליחות, או שכולן מתבטלות (Rollback) במקרה של כשל.
* **Rollback במקרה של חריגות:** כיצד חריגה (Exception) הנזרקת במהלך מתודה טרנזקציונלית גורמת לביטול כל השינויים שבוצעו במסגרת אותה טרנזקציה.
* **תצורת Rollback:** שימוש בפרמטר `rollbackOn` באנוטציה `@Transactional` כדי להגדיר אילו סוגי חריגות יגרמו ל-Rollback.
* **ולידציה ברמת השירות:** ביצוע בדיקות תקינות בתוך מתודות השירות שיכולות להוביל לזריקת חריגה ולביטול הטרנזקציה.
* **קריאות פנימיות למתודות טרנזקציונליות:** הדגמת הבעיה שקריאה ישירה מתוך מתודה באותה מחלקה למתודה טרנזקציונלית אחרת באותה מחלקה עוקפת את ה-Proxy של Spring (ולכן הטרנזקציה לא תנוהל כראוי), והצגת פתרון באמצעות `ApplicationContext.getBean()` כדי לקבל את ה-Proxy.
* **טיפול בחריגות מותאמות אישית:** יצירת חריגות כמו `RollingBackException` ו-`ResourceNotFoundException` וטיפול בהן ב-`GlobalExceptionHandler`.

## איך הוא בנוי? (הארכיטקטורה)

הפרויקט בנוי במבנה שכבות סטנדרטי של Spring Boot:

1.  **קומת הבקרים (Controllers):**
    * `SchoolController`: חושף נקודות קצה (endpoints) לביצוע פעולות כמו יצירה ועדכון של מורים ותלמידים, ובדיקת התנהגות Rollback.

2.  **קומת השירותים (Services):**
    * `ISchoolService` (ממשק) ו-`SchoolServiceImpl` (מימוש):
        * מכילים את הלוגיקה העסקית.
        * מתודות כמו `createTeacherAndStudent` ו-`updateTeacherAndStudent` מסומנות ב-`@Transactional` עם `rollbackOn = Exception.class` כדי להבטיח שכל חריגה תגרום ל-Rollback.
        * מדגימים ולידציה ברמת השירות שעלולה לגרום ל-Rollback (למשל, אם שם המורה מכיל "error" או שהמקצוע הוא "Invalid").
        * מדגימים קריאה ל-Proxy של השירות עצמו דרך `ApplicationContext` במתודת `batchProcessStudents` כדי להבטיח התנהגות טרנזקציונלית נכונה למתודה `processStudentInTransaction`.

3.  **קומת מאגרי המידע (Repositories):**
    * `StudentRepository` ו-`TeacherRepository`: ממשקי Spring Data JPA סטנדרטיים לגישה לנתוני התלמידים והמורים.

4.  **קומת הישויות (Entities):**
    * `Student`: ישות תלמיד, עם שדות כמו שם, אימייל, ומזהה המורה (`teacherId`).
    * `Teacher`: ישות מורה, עם שדות כמו שם ומקצוע.

5.  **קומת אובייקטי העברת נתונים (DTOs):**
    * `CreateRequest`: DTO לקלט של יצירת מורה ותלמיד.
    * `UpdateRequest`: DTO לקלט של עדכון מורה ותלמיד.

6.  **טיפול בשגיאות (Exceptions):**
    * `RollingBackException`: חריגה מותאמת אישית שנועדה במפורש לגרום ל-Rollback.
    * `ResourceNotFoundException`: חריגה למקרה שמשאב לא נמצא.
    * `GlobalExceptionHandler`: מטפל בחריגות אלו ובחריגות ולידציה (`MethodArgumentNotValidException`) ומחזיר `StandardResponse` מתאים.

7.  **תגובות סטנדרטיות (Response):**
    * `StandardResponse`: מבנה אחיד לתגובות מה-API.

## מטרות הפרויקט:

* **לימוד והדגמה של מנגנון הטרנזקציות ב-Spring:** הבנת החשיבות של `@Transactional`.
* **הדגמת Rollback אוטומטי:** כיצד שגיאות וחריגות גורמות לביטול שינויים.
* **הבנת התנהגות Proxy של Spring בהקשר של טרנזקציות:** מתי טרנזקציה מנוהלת ומתי לא (בקריאות פנימיות).
* **יישום ולידציות ברמת השירות** המשפיעות על זרימת הטרנזקציה.
* **שילוב טיפול בחריגות עם לוגיקה טרנזקציונלית.**

## טכנולוגיות עיקריות:

* Java, Spring Boot, Spring Data JPA, Hibernate, MySQL, Lombok, Jakarta Bean Validation.
* דגש מיוחד על `@Transactional` ועל `jakarta.transaction.Transactional`.

## מה לומדים מהפרויקט?

* **חשיבות האטומיות (Atomicity):** כיצד טרנזקציות מבטיחות שפעולות מרובות הן "הכל או כלום".
* **תצורת `@Transactional`:** הבנת `rollbackOn` וההבדל מברירת המחדל (שמבצעת Rollback רק עבור `RuntimeException`).
* **מנגנון ה-Proxy של Spring:** מדוע קריאות פנימיות למתודות באותה מחלקה עשויות לא להפעיל את מנגנון הטרנזקציה, וכיצד להתמודד עם זה.
* **לוגיקה של Rollback:** כיצד לגרום במכוון ל-Rollback על סמך תנאים עסקיים.
* **השילוב בין ולידציה (`@Valid`) לטרנזקציות:** כיצד כשל בוולידציה יכול למנוע התחלת טרנזקציה או לגרום לביטולה אם הוולידציה מתבצעת בתוך המתודה הטרנזקציונלית.

## לסיכום:

פרויקט `TransactionalDemo` הוא כלי לימודי מצוין להבנת אחד ההיבטים החשובים והבסיסיים ביותר בעבודה עם בסיסי נתונים באפליקציות ארגוניות – ניהול טרנזקציות. הוא מדגים בצורה ברורה כיצד Spring מפשט את ניהול הטרנזקציות ומספק כלים להבטחת עקביות ושלמות הנתונים.</div>