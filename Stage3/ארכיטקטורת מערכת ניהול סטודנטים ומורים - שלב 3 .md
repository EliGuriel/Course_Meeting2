<div dir="rtl">

# × ×™×ª×•×— ××¢×¨×›×ª × ×™×”×•×œ ×¡×˜×•×“× ×˜×™× ×•××•×¨×™×

## ×ª×•×›×Ÿ ×¢× ×™×™× ×™×
1. [×¡×§×™×¨×” ×›×œ×œ×™×ª](#×¡×§×™×¨×”-×›×œ×œ×™×ª)
2. [××¨×›×™×˜×§×˜×•×¨×ª ×”××¢×¨×›×ª](#××¨×›×™×˜×§×˜×•×¨×ª-×”××¢×¨×›×ª)
3. [××•×“×œ ×”× ×ª×•× ×™×](#××•×“×œ-×”× ×ª×•× ×™×)
4. [×™×—×¡×™ One-to-Many](#×™×—×¡×™-one-to-many)
5. [StandardResponse ×•×× ×’× ×•×Ÿ ×ª×’×•×‘×•×ª ××—×™×“](#standardresponse-×•×× ×’× ×•×Ÿ-×ª×’×•×‘×•×ª-××—×™×“)
6. [×˜×™×¤×•×œ ×‘×©×’×™××•×ª](#×˜×™×¤×•×œ-×‘×©×’×™××•×ª)
7. [×“×•×’×××•×ª ×©××™×œ×ª×•×ª HTTP ×¢×™×§×¨×™×•×ª](#×“×•×’×××•×ª-×©××™×œ×ª×•×ª-http-×¢×™×§×¨×™×•×ª)
8. [×ª×™×§×•×£ × ×ª×•× ×™×](#×ª×™×§×•×£-× ×ª×•× ×™×)
9. [×¡×™×›×•×](#×¡×™×›×•×)

## ×¡×§×™×¨×” ×›×œ×œ×™×ª

××¢×¨×›×ª × ×™×”×•×œ ×”×¡×˜×•×“× ×˜×™× ×•×”××•×¨×™× ×”×™× ××¤×œ×™×§×¦×™×™×ª Spring Boot ×”××××©×ª REST API ×œ× ×™×”×•×œ ××™×“×¢ ××§×“××™. ×”××¢×¨×›×ª ×××¤×©×¨×ª × ×™×”×•×œ ×¡×˜×•×“× ×˜×™×, ××•×¨×™×, ×¤×¨×˜×™ ×¡×˜×•×“× ×˜×™× ×•×”×§×©×¨×™× ×‘×™× ×™×”×, ×¢× ×“×’×© ×¢×œ ×™×—×¡×™ One-to-Many ×‘×™×Ÿ ××•×¨×™× ×œ×¡×˜×•×“× ×˜×™×.


# ××¨×›×™×˜×§×˜×•×¨×ª ×”××¢×¨×›×ª

×”××¢×¨×›×ª ×‘× ×•×™×” ×‘××¨×›×™×˜×§×˜×•×¨×ª ×©×›×‘×•×ª (Layered Architecture) ×”×××¤×©×¨×ª ×”×¤×¨×“×” ×‘×¨×•×¨×” ×‘×™×Ÿ ×¨×›×™×‘×™×, ×’××™×©×•×ª ×‘×ª×—×–×•×§×” ×•×”×¨×—×‘×”, ×•×—×œ×•×§×ª ××—×¨×™×•×ª ×‘×¨×•×¨×”. ×›×œ ×©×›×‘×” ××¡×¤×§×ª ×©×™×¨×•×ª×™× ×œ×©×›×‘×” ×©××¢×œ×™×” ×•××©×ª××©×ª ×‘×©×™×¨×•×ª×™× ×©×œ ×”×©×›×‘×” ×©××ª×—×ª×™×”.

## ×©×›×‘×•×ª ×”××¢×¨×›×ª

### ğŸŒ Controllers
××—×¨××™× ×¢×œ ×§×‘×œ×ª ×‘×§×©×•×ª HTTP, ×¢×™×‘×•×“ ×¤×¨××˜×¨×™×, ×•×”×—×–×¨×ª ×ª×©×•×‘×•×ª ×‘××‘× ×” ××—×™×“.

* **`StudentController`** - × ×™×”×•×œ ×¤×¢×•×œ×•×ª ×¢×œ ×¡×˜×•×“× ×˜×™×
* **`StudentDetailsController`** - × ×™×”×•×œ ×¤×¨×˜×™× ××•×¨×—×‘×™× ×©×œ ×¡×˜×•×“× ×˜×™×
* **`TeacherController`** - × ×™×”×•×œ ×¤×¢×•×œ×•×ª ×¢×œ ××•×¨×™×

### âš™ï¸ Services
××›×™×œ×™× ××ª ×”×œ×•×’×™×§×” ×”×¢×¡×§×™×ª ×©×œ ×”××¢×¨×›×ª ×•××§×©×¨×™× ×‘×™×Ÿ ×”-Controllers ×œ×‘×™×Ÿ ×”-Repositories.

* **`StudentService`** ×•-**`StudentServiceImpl`**
* **`StudentDetailsService`** ×•-**`StudentDetailsServiceImpl`**
* **`TeacherService`** ×•-**`TeacherServiceImpl`**

### ğŸ’¾ Repositories
××—×¨××™× ×¢×œ ×’×™×©×” ×œ××¡×“ ×”× ×ª×•× ×™×, ××‘×¦×¢×™× ×©××™×œ×ª×•×ª ×•×¢×“×›×•× ×™×.

* **`StudentRepository`**
* **`StudentDetailsRepository`**
* **`TeacherRepository`**

### ğŸ“‹ Entities
××’×“×™×¨×™× ××ª ××•×“×œ ×”× ×ª×•× ×™× ×•××™×™×¦×’×™× ××ª ×”×˜×‘×œ××•×ª ×‘××¡×“ ×”× ×ª×•× ×™×.

* **`Student`**
* **`StudentDetails`**
* **`Teacher`**

### ğŸ“¦ DTOs (Data Transfer Objects)
××©××©×™× ×œ×”×¢×‘×¨×ª × ×ª×•× ×™× ×‘×™×Ÿ ×©×›×‘×•×ª ×”××¢×¨×›×ª, ××•× ×¢×™× ×—×©×™×¤×ª ××•×“×œ ×”× ×ª×•× ×™× ×”××œ×.

* **`StudentDto`**
* **`StudentDetailsDto`**
* **`TeacherDto`**
* **`TeacherBasicDto`** - ×’×¨×¡×” ××¦×•××¦××ª ×©×œ ×¤×¨×˜×™ ×”××•×¨×”

### ğŸ“¤ Responses
××’×“×™×¨×™× ××‘× ×” ×ª×’×•×‘×” ××—×™×“ ×œ×›×œ ×”×‘×§×©×•×ª ×‘××¢×¨×›×ª.

* **`StandardResponse`** - ××‘× ×” ×ª×©×•×‘×” ××—×™×“
* **`GlobalResponseHandler`** - ×¢×™×‘×•×“ ×ª×©×•×‘×•×ª ×’×œ×•×‘×œ×™

### âš ï¸ Exceptions
××’×“×™×¨×™× ×—×¨×™×’×™× ×¡×¤×¦×™×¤×™×™× ×œ××¢×¨×›×ª ×•×× ×’× ×•×Ÿ ×˜×™×¤×•×œ ×‘×©×’×™××•×ª.

* **`NotExists`** - ×™×©×•×ª ××‘×•×§×©×ª ×œ× ×§×™×™××ª
* **`AlreadyExists`** - ×™×©×•×ª ×›×‘×¨ ×§×™×™××ª (×‘××§×¨×” ×©×œ ×™×¦×™×¨×”)
* **`StudentIdAndIdMismatch`** - ×—×•×¡×¨ ×”×ª×××” ×‘×™×Ÿ ××–×”×™×
* **`InvalidRequestException`** - ×‘×§×©×” ×œ× ×ª×§×™× ×”
* **`GlobalExceptionHandler`** - ×˜×™×¤×•×œ ××¨×›×–×™ ×‘×—×¨×™×’×™×

## ×™×ª×¨×•× ×•×ª ×”××¨×›×™×˜×§×˜×•×¨×”

* **×”×¤×¨×“×ª ××—×¨×™×•×ª** - ×›×œ ×©×›×‘×” ××—×¨××™×ª ×¢×œ ×”×™×‘×˜ ×¡×¤×¦×™×¤×™ ×©×œ ×”××¢×¨×›×ª
* **×’××™×©×•×ª ×œ×©×™× ×•×™×™×** - × ×™×ª×Ÿ ×œ×”×—×œ×™×£ ×©×›×‘×” ××‘×œ×™ ×œ×”×©×¤×™×¢ ×¢×œ ×©×›×‘×•×ª ××—×¨×•×ª
* **×ª×—×–×•×§×ª×™×•×ª** - ×§×œ ×™×•×ª×¨ ×œ××ª×¨ ×•×œ×ª×§×Ÿ ×‘××’×™×
* **×‘×“×™×§×ª×™×•×ª** - × ×™×ª×Ÿ ×œ×‘×“×•×§ ×›×œ ×©×›×‘×” ×‘× ×¤×¨×“
* **××•×“×•×œ×¨×™×•×ª** - ×§×œ ×œ×”×•×¡×™×£ ×¤×•× ×§×¦×™×•× ×œ×™×•×ª ×—×“×©×”


## ××•×“×œ ×”× ×ª×•× ×™×

×”××¢×¨×›×ª ××‘×•×¡×¡×ª ×¢×œ ×©×œ×•×© ×™×©×•×™×•×ª ×¢×™×§×¨×™×•×ª ×”××§×•×©×¨×•×ª ×‘×™× ×™×”×Ÿ ×‘×××¦×¢×•×ª ×™×—×¡×™× ××•×’×“×¨×™×.

## ×™×©×•×™×•×ª ×”××¢×¨×›×ª

### ğŸ§‘â€ğŸ“ Student
××™×™×¦×’ ××ª ×¤×¨×˜×™ ×”×¡×˜×•×“× ×˜ ×”×‘×¡×™×¡×™×™× ×‘××¢×¨×›×ª.

| ×©×“×” | ×ª×™××•×¨ |
|------|---------|
| `id` | ××–×”×” ×™×™×—×•×“×™ ×©×œ ×”×¡×˜×•×“× ×˜ |
| `firstName` | ×©× ×¤×¨×˜×™ |
| `lastName` | ×©× ××©×¤×—×” |
| `age` | ×’×™×œ |
| `email` | ×›×ª×•×‘×ª ×“×•×"×œ |

### ğŸ“‹ StudentDetails
××›×™×œ ××™×“×¢ ××•×¨×—×‘ ×•××©×œ×™× ×¢×œ ×”×¡×˜×•×“× ×˜.

| ×©×“×” | ×ª×™××•×¨ |
|------|---------|
| `id` | ××–×”×” ×™×™×—×•×“×™ ×©×œ ×¤×¨×˜×™ ×”×¡×˜×•×“× ×˜ |
| `address` | ×›×ª×•×‘×ª ××’×•×¨×™× ××œ××” |
| `phone` | ××¡×¤×¨ ×˜×œ×¤×•×Ÿ |
| `emergencyContact` | ×¤×¨×˜×™ ××™×© ×§×©×¨ ×œ×©×¢×ª ×—×™×¨×•× |

### ğŸ‘¨â€ğŸ« Teacher
××™×™×¦×’ ××ª ×”××•×¨×” ×”××—×¨××™ ×‘×ª×”×œ×™×š ×”×œ×™××•×“×™.

| ×©×“×” | ×ª×™××•×¨ |
|------|---------|
| `id` | ××–×”×” ×™×™×—×•×“×™ ×©×œ ×”××•×¨×” |
| `name` | ×©× ××œ× |
| `subject` | ×ª×—×•× ×”×ª××—×•×ª/××§×¦×•×¢ ×”×•×¨××” |

## ×™×—×¡×™× ×‘×™×Ÿ ×”×™×©×•×™×•×ª

<div dir="ltr">

``` mermaid
classDiagram
    class Student {
        +int id
        +string firstName
        +string lastName
        +int age
        +string email
    }
    
    class StudentDetails {
        +int id
        +string address
        +string phone
        +string emergencyContact
    }
    
    class Teacher {
        +int id
        +string name
        +string subject
    }
    
    Student "1" -- "1" StudentDetails : contains
    Student "*" -- "1" Teacher : studies with
    Teacher "1" -- "*" Student : teaches
    
    note for Student "Student entity in system. All relationships are Bidirectional"
    note for StudentDetails "Additional student information"
    note for Teacher "Teacher information and specialization"
```
![stage3_db.png](stage3_db.png)

</div>

<div dir="rtl">

### ×§×©×¨×™× ××•×’×“×¨×™×:
* **Student â†” StudentDetails**: ×§×©×¨ ×—×“-×—×“ (One-to-One)
* **Student â†” Teacher**: ×§×©×¨ ×¨×‘×™×-×œ××—×“ (Many-to-One) - ××•×¨×” ×™×›×•×œ ×œ×œ××“ ××¡×¤×¨ ×¡×˜×•×“× ×˜×™×

## ×™×—×¡×™ One-to-Many

×”××¢×¨×›×ª ××™×™×©××ª ×™×—×¡×™ One-to-Many ×‘×™×Ÿ ××•×¨×™× ×œ×¡×˜×•×“× ×˜×™× ×‘××•×¤×Ÿ ×‘×™-×“×™×¨×§×¦×™×•× ×œ×™:

</div>

<div dir="ltr">

```java
// ×‘×™×©×•×ª Teacher
@OneToMany(mappedBy = "teacher", cascade = CascadeType.ALL)
@ToString.Exclude
private List<Student> students = new ArrayList<>();

// ××ª×•×“×•×ª ×¢×–×¨ ×œ× ×™×”×•×œ ×”×™×—×¡
public void addStudent(Student student) {
    students.add(student);
    student.setTeacher(this);
}

public void removeStudent(Student student) {
    students.remove(student);
    student.setTeacher(null);
}

// ×‘×™×©×•×ª Student
@ManyToOne
@JoinColumn(name = "teacher_id")
@ToString.Exclude
private Teacher teacher;
```

<div dir="rtl">

× ×™×”×•×œ ×”×™×—×¡×™× ××ª×‘×¦×¢ ×‘×–×”×™×¨×•×ª ×‘×©×›×‘×ª ×”×©×™×¨×•×ª:

</div>

<div dir="ltr">

```java
// ×”×§×¦××ª ××•×¨×” ×œ×¡×˜×•×“× ×˜
@Override
@Transactional
public StudentDto assignTeacherToStudent(Long studentId, Long teacherId) {
    Student student = studentRepository.findById(studentId)
            .orElseThrow(() -> new NotExists("Student with id " + studentId + " does not exist"));
    
    Teacher teacher = teacherRepository.findById(teacherId)
            .orElseThrow(() -> new NotExists("Teacher with id " + teacherId + " does not exist"));
    
    // ×× ×œ×¡×˜×•×“× ×˜ ×›×‘×¨ ×™×© ××•×¨×”, ××¡×™×¨×™× ××•×ª×• ××”××•×¨×” ×”×§×•×“×
    if (student.getTeacher() != null) {
        if (student.getTeacher().getId().equals(teacherId)) {
            throw new AlreadyExists("Student is already assigned to this teacher");
        }
        student.getTeacher().removeStudent(student);
    }
    
    // ×”×§×¦××” ×œ××•×¨×” ×”×—×“×©
    teacher.addStudent(student);
    
    Student updated = studentRepository.save(student);
    return studentMapper.toDto(updated);
}
```

<div dir="rtl">

## StandardResponse ×•×× ×’× ×•×Ÿ ×ª×’×•×‘×•×ª ××—×™×“

×”××¢×¨×›×ª ××™×™×©××ª ××‘× ×” ×ª×’×•×‘×” ××—×™×“ ×‘×××¦×¢×•×ª `StandardResponse`

×”××¢×¨×›×ª ××‘×˜×™×—×” ×©×›×œ ×”×ª×’×•×‘×•×ª ××”×©×¨×ª ×™×”×™×• ×‘-`StandardResponse` ×‘×××¦×¢×•×ª `GlobalResponseHandler`


## ×˜×™×¤×•×œ ×‘×©×’×™××•×ª

×”××¢×¨×›×ª ×›×•×œ×œ×ª ×× ×’× ×•×Ÿ ×˜×™×¤×•×œ ×‘×©×’×™××•×ª ××§×™×£ ×‘×××¦×¢×•×ª `GlobalExceptionHandler`


## ×“×•×’×××•×ª ×©××™×œ×ª×•×ª HTTP ×¢×™×§×¨×™×•×ª

### ×§×‘×œ×ª ×›×œ ×”×¡×˜×•×“× ×˜×™×


</div>

<div dir="ltr">

```http
GET /students HTTP/1.1
Host: localhost:8080
Accept: application/json
```

```json
{
  "status": "success",
  "data": [
    {
      "id": 1,
      "firstName": "××©×”",
      "lastName": "×›×”×Ÿ",
      "age": 21.5,
      "email": "moshe.cohen@example.com",
      "details": {
        "id": 1,
        "address": "×”×¨×¦×œ 123, ×ª×œ ××‘×™×‘",
        "phoneNumber": "+972541234567",
        "emergencyContactName": "×©×¨×” ×›×”×Ÿ",
        "emergencyContactPhone": "+972541234568"
      },
      "teacher": {
        "id": 1,
        "name": "×“×•×“ ×›×”×Ÿ",
        "subject": "××ª××˜×™×§×”"
      }
    }
  ],
  "error": null,
  "timestamp": "2023-07-25T14:30:15.123"
}
```

<div dir="rtl">

### ×”×•×¡×¤×ª ×¡×˜×•×“× ×˜ ×—×“×©

</div>

<div dir="ltr">

```http
POST /students HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Accept: application/json

{
  "firstName": "×¨×•×Ÿ",
  "lastName": "×™×©×¨××œ×™",
  "age": 20.5,
  "email": "ron.israeli@example.com",
  "details": {
    "address": "×“×™×–× ×’×•×£ 100, ×ª×œ ××‘×™×‘",
    "phoneNumber": "+972541234599",
    "emergencyContactName": "××¨×™× ×™×©×¨××œ×™",
    "emergencyContactPhone": "+972541234600"
  }
}
```

```json
{
  "status": "success",
  "data": {
    "id": 6,
    "firstName": "×¨×•×Ÿ",
    "lastName": "×™×©×¨××œ×™",
    "age": 20.5,
    "email": "ron.israeli@example.com",
    "details": {
      "id": 6,
      "address": "×“×™×–× ×’×•×£ 100, ×ª×œ ××‘×™×‘",
      "phoneNumber": "+972541234599",
      "emergencyContactName": "××¨×™× ×™×©×¨××œ×™",
      "emergencyContactPhone": "+972541234600"
    },
    "teacher": null
  },
  "error": null,
  "timestamp": "2023-07-25T14:32:45.789"
}
```

</div>

<div dir="rtl">

### ×”×§×¦××ª ××•×¨×” ×œ×¡×˜×•×“× ×˜

</div>

```http
POST /students/5/teacher/2 HTTP/1.1
Host: localhost:8080
Accept: application/json
```

<div dir="ltr">

```json
{
  "status": "success",
  "data": {
    "id": 5,
    "firstName": "×××™×¨",
    "lastName": "×“×”×Ÿ",
    "age": 22.8,
    "email": "amit.dahan@example.com",
    "details": null,
    "teacher": {
      "id": 2,
      "name": "×©×¨×” ×œ×•×™",
      "subject": "×¤×™×–×™×§×”"
    }
  },
  "error": null,
  "timestamp": "2023-07-25T14:34:12.456"
}
```


<div dir="rtl">

### ×“×•×’×× ×œ×©×’×™××” - × ×™×¡×™×•×Ÿ ×œ×”×§×¦×•×ª ××•×¨×” ×œ×¡×˜×•×“× ×˜ ×©××™× ×• ×§×™×™×

</div>

<div dir="ltr">

```http
POST /students/999/teacher/1 HTTP/1.1
Host: localhost:8080
Accept: application/json
```

```json
{
  "status": "error",
  "data": null,
  "error": {
    "type": "Resource Not Found",
    "message": "Student with id 999 does not exist"
  },
  "timestamp": "2023-07-25T14:35:20.123"
}
```

<div dir="rtl">

## ×ª×™×§×•×£ × ×ª×•× ×™×

×”××¢×¨×›×ª ××©×ª××©×ª ×‘×× ×•×˜×¦×™×•×ª Jakarta Validation ×œ×ª×™×§×•×£ × ×ª×•× ×™×:

### StudentDto

</div>

<div dir="ltr">

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class StudentDto {
    private Long id;

    @NotBlank(message = "First name is required")
    @Size(min = 2, max = 50, message = "First name must be between 2 and 50 characters")
    private String firstName;

    @NotBlank(message = "Last name is required")
    @Size(min = 2, max = 50, message = "Last name must be between 2 and 50 characters")
    private String lastName;

    @Min(value = 0, message = "Age must be a positive number")
    private double age;

    @NotBlank(message = "Email is required")
    @Email(message = "Email should be valid")
    private String email;

    // Making sure to validate the nested object
    @Valid
    private StudentDetailsDto details;
    
    // Reference to teacher
    private TeacherBasicDto teacher;
}
```

<div dir="rtl">

### StudentDetailsDto

</div>

<div dir="ltr">

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class StudentDetailsDto {
    private Long id;
    
    private Long studentId;

    @Size(max = 255, message = "Address must be less than 255 characters")
    private String address;

    @Pattern(regexp = "^\\+?(972|0)([23459]\\d{7}|5\\d{8})$",
            message = "Phone number must be a valid Israeli phone number (e.g., +972541234567 or 0541234567)")
    private String phoneNumber;

    @Size(max = 100, message = "Emergency contact name must be less than 100 characters")
    private String emergencyContactName;

    @Pattern(regexp = "^\\+?(972|0)([23459]\\d{7}|5\\d{8})$",
            message = "Emergency contact phone must be a valid Israeli phone number (e.g., +972541234567 or 0541234567)")
    private String emergencyContactPhone;
}
```

<div dir="rtl">

### TeacherDto

</div>

<div dir="ltr">

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class TeacherDto {
    private Long id;

    @NotBlank(message = "Name is required")
    @Size(min = 2, max = 50, message = "Name must be between 2 and 50 characters")
    private String name;

    @NotBlank(message = "Subject is required")
    @Size(min = 2, max = 50, message = "Subject must be between 2 and 50 characters")
    private String subject;
    
    // List of student IDs taught by this teacher
    private List<Long> studentIds = new ArrayList<>();
}
```

<div dir="rtl">

××¢×¨×›×ª × ×™×”×•×œ ×”×¡×˜×•×“× ×˜×™× ×•×”××•×¨×™× ××™×™×©××ª ×¢×§×¨×•× ×•×ª ××¨×›×™×˜×§×˜×•×¨×ª Spring Boot ××•×“×¨× ×™×ª, ×¢×:

1. **×”×¤×¨×“×ª ××—×¨×™×•×ª** ×‘×™×Ÿ ×©×›×‘×•×ª ×”××¢×¨×›×ª ×”×©×•× ×•×ª
2. **××‘× ×” ×ª×’×•×‘×” ××—×™×“** ×‘×××¦×¢×•×ª StandardResponse
3. **×˜×™×¤×•×œ ×‘×©×’×™××•×ª ××§×™×£** ×¢× GlobalExceptionHandler
4. **× ×™×”×•×œ ×™×—×¡×™ One-to-Many** ×‘×™×Ÿ ××•×¨×™× ×œ×¡×˜×•×“× ×˜×™×
5. **×ª×™×§×•×£ × ×ª×•× ×™×** ×‘×××¦×¢×•×ª Jakarta Validation
6. **REST API** ××§×™×£ ×œ× ×™×”×•×œ ××™×“×¢ ××§×“××™

×”××¢×¨×›×ª ××“×’×™××” ×™×™×©×•× × ×›×•×Ÿ ×©×œ ×”×¤×¨×§×˜×™×§×•×ª ×”××•××œ×¦×•×ª ×‘×¤×™×ª×•×— Spring Boot, ×¢× ×“×’×© ×¢×œ ×ª×—×–×•×§×ª×™×•×ª, ×’××™×©×•×ª, ×•×‘×˜×™×—×•×ª × ×ª×•× ×™×.

</div>